import{a as qt,Q as A,V as L,A as kt,ad as Ke,N as G,p as D,a8 as Rt,M as E,D as ut,ae as Oe,w as et,H as U,n as Ye,c as Ve,W as Xe,b as Jt,B as St,o as Qe,X as Ze,Y as Je,Z as ts,_ as es,j as ss,k as ns,l as is,m as rs,$ as as,af as os,E as N,ag as hs,P as nt,ah as ls,t as dt,e as ke,ai as cs,aj as us,v as Me,ak as te,a6 as Z,ab as ds}from"./B7bWcIpR.js";class fs extends qt{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return A(L,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return A(L,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return A(L,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return A(L,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return A(L,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const s in this.chars)(e=this.chars[s].texture)==null||e.destroy();this.chars=null,t&&(this.pages.forEach(s=>s.texture.destroy(!0)),this.pages=null)}}const ee=[{offset:0,color:"white"},{offset:1,color:"black"}],jt=class At{constructor(...t){this.uid=kt("fillGradient"),this.type="linear",this.colorStops=[];let e=ps(t);e={...e.type==="radial"?At.defaultRadialOptions:At.defaultLinearOptions,...Ke(e)},this._textureSize=e.textureSize,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:G.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:ee,e=this._textureSize,{canvas:s,context:n}=ne(e,1),i=n.createLinearGradient(0,0,this._textureSize,0);se(i,t),n.fillStyle=i,n.fillRect(0,0,e,1),this.texture=new D({source:new Rt({resource:s})});const{x:r,y:o}=this.start,{x:l,y:c}=this.end,h=new E,u=l-r,f=c-o,d=Math.sqrt(u*u+f*f),p=Math.atan2(f,u);h.scale(d/e,1),h.rotate(p),h.translate(r,o),this.textureSpace==="local"&&h.scale(e,e),this.transform=h}buildGradient(){this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:ee,e=this._textureSize,{canvas:s,context:n}=ne(e,e),{x:i,y:r}=this.center,{x:o,y:l}=this.outerCenter,c=this.innerRadius,h=this.outerRadius,u=o-h,f=l-h,d=e/(h*2),p=(i-u)*d,g=(r-f)*d,y=n.createRadialGradient(p,g,c*d,(o-u)*d,(l-f)*d,h*d);se(y,t),n.fillStyle=t[t.length-1].color,n.fillRect(0,0,e,e),n.fillStyle=y,n.translate(p,g),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-p,-g),n.fillRect(0,0,e,e),this.texture=new D({source:new Rt({resource:s,addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"})});const m=new E;m.scale(1/d,1/d),m.translate(u,f),this.textureSpace==="local"&&m.scale(e,e),this.transform=m}get styleKey(){return this.uid}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null}};jt.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256};jt.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256};let O=jt;function se(a,t){for(let e=0;e<t.length;e++){const s=t[e];a.addColorStop(s.offset,s.color)}}function ne(a,t){const e=ut.get().createCanvas(a,t),s=e.getContext("2d");return{canvas:e,context:s}}function ps(a){let t=a[0]??{};return(typeof t=="number"||a[1])&&(A("8.5.2","use options object instead"),t={type:"linear",start:{x:a[0],y:a[1]},end:{x:a[2],y:a[3]},textureSpace:a[4],textureSize:a[5]??O.defaultLinearOptions.textureSize}),t}const ie={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Mt{constructor(t,e){this.uid=kt("fillPattern"),this.transform=new E,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=ie[e].addressModeU,t.source.style.addressModeV=ie[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}var Bt,re;function gs(){if(re)return Bt;re=1,Bt=e;var a={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(i){var r=[];return i.replace(t,function(o,l,c){var h=l.toLowerCase();for(c=n(c),h=="m"&&c.length>2&&(r.push([l].concat(c.splice(0,2))),h="l",l=l=="m"?"l":"L");;){if(c.length==a[h])return c.unshift(l),r.push(c);if(c.length<a[h])throw new Error("malformed path data");r.push([l].concat(c.splice(0,a[h])))}}),r}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function n(i){var r=i.match(s);return r?r.map(Number):[]}return Bt}var ys=gs();const xs=Oe(ys);function ms(a,t){const e=xs(a),s=[];let n=null,i=0,r=0;for(let o=0;o<e.length;o++){const l=e[o],c=l[0],h=l;switch(c){case"M":i=h[1],r=h[2],t.moveTo(i,r);break;case"m":i+=h[1],r+=h[2],t.moveTo(i,r);break;case"H":i=h[1],t.lineTo(i,r);break;case"h":i+=h[1],t.lineTo(i,r);break;case"V":r=h[1],t.lineTo(i,r);break;case"v":r+=h[1],t.lineTo(i,r);break;case"L":i=h[1],r=h[2],t.lineTo(i,r);break;case"l":i+=h[1],r+=h[2],t.lineTo(i,r);break;case"C":i=h[5],r=h[6],t.bezierCurveTo(h[1],h[2],h[3],h[4],i,r);break;case"c":t.bezierCurveTo(i+h[1],r+h[2],i+h[3],r+h[4],i+h[5],r+h[6]),i+=h[5],r+=h[6];break;case"S":i=h[3],r=h[4],t.bezierCurveToShort(h[1],h[2],i,r);break;case"s":t.bezierCurveToShort(i+h[1],r+h[2],i+h[3],r+h[4]),i+=h[3],r+=h[4];break;case"Q":i=h[3],r=h[4],t.quadraticCurveTo(h[1],h[2],i,r);break;case"q":t.quadraticCurveTo(i+h[1],r+h[2],i+h[3],r+h[4]),i+=h[3],r+=h[4];break;case"T":i=h[1],r=h[2],t.quadraticCurveToShort(i,r);break;case"t":i+=h[1],r+=h[2],t.quadraticCurveToShort(i,r);break;case"A":i=h[6],r=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,r);break;case"a":i+=h[6],r+=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,r);break;case"Z":case"z":t.closePath(),s.length>0&&(n=s.pop(),n?(i=n.startX,r=n.startY):(i=0,r=0)),n=null;break;default:et(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:i,startY:r},s.push(n))}return t}class $t{constructor(t=0,e=0,s=0){this.type="circle",this.x=t,this.y=e,this.radius=s}clone(){return new $t(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-t,i=this.y-e;return n*=n,i*=i,n+i<=s}strokeContains(t,e,s,n=.5){if(this.radius===0)return!1;const i=this.x-t,r=this.y-e,o=this.radius,l=(1-n)*s,c=Math.sqrt(i*i+r*r);return c<=o+l&&c>o-(s-l)}getBounds(t){return t||(t=new U),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Nt{constructor(t=0,e=0,s=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=s,this.halfHeight=n}clone(){return new Nt(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(t,e,s,n=.5){const{halfWidth:i,halfHeight:r}=this;if(i<=0||r<=0)return!1;const o=s*(1-n),l=s-o,c=i-l,h=r-l,u=i+o,f=r+o,d=t-this.x,p=e-this.y,g=d*d/(c*c)+p*p/(h*h),y=d*d/(u*u)+p*p/(f*f);return g>1&&y<=1}getBounds(t){return t||(t=new U),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function _s(a,t,e,s,n,i){const r=a-e,o=t-s,l=n-e,c=i-s,h=r*l+o*c,u=l*l+c*c;let f=-1;u!==0&&(f=h/u);let d,p;f<0?(d=e,p=s):f>1?(d=n,p=i):(d=e+f*l,p=s+f*c);const g=a-d,y=t-p;return g*g+y*y}let Ss,bs;class ft{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const s=[];for(let n=0,i=e.length;n<i;n++)s.push(e[n].x,e[n].y);e=s}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,s=e.length;for(let n=0;n<s;n+=2){const i=e[n],r=e[n+1],o=e[(n+2)%s],l=e[(n+3)%s];t+=(o-i)*(l+r)}return t<0}containsPolygon(t){const e=this.getBounds(Ss),s=t.getBounds(bs);if(!e.containsRect(s))return!1;const n=t.points;for(let i=0;i<n.length;i+=2){const r=n[i],o=n[i+1];if(!this.contains(r,o))return!1}return!0}clone(){const t=this.points.slice(),e=new ft(t);return e.closePath=this.closePath,e}contains(t,e){let s=!1;const n=this.points.length/2;for(let i=0,r=n-1;i<n;r=i++){const o=this.points[i*2],l=this.points[i*2+1],c=this.points[r*2],h=this.points[r*2+1];l>e!=h>e&&t<(c-o)*((e-l)/(h-l))+o&&(s=!s)}return s}strokeContains(t,e,s,n=.5){const i=s*s,r=i*(1-n),o=i-r,{points:l}=this,c=l.length-(this.closePath?0:2);for(let h=0;h<c;h+=2){const u=l[h],f=l[h+1],d=l[(h+2)%l.length],p=l[(h+3)%l.length],g=_s(t,e,u,f,d,p),y=Math.sign((d-u)*(e-f)-(p-f)*(t-u));if(g<=(y<0?o:r))return!0}return!1}getBounds(t){t||(t=new U);const e=this.points;let s=1/0,n=-1/0,i=1/0,r=-1/0;for(let o=0,l=e.length;o<l;o+=2){const c=e[o],h=e[o+1];s=c<s?c:s,n=c>n?c:n,i=h<i?h:i,r=h>r?h:r}return t.x=s,t.width=n-s,t.y=i,t.height=r-i,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const bt=(a,t,e,s,n,i,r)=>{const o=a-e,l=t-s,c=Math.sqrt(o*o+l*l);return c>=n-i&&c<=n+r};class Ut{constructor(t=0,e=0,s=0,n=0,i=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=s,this.height=n,this.radius=i}getBounds(t){return t||(t=new U),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Ut(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let n=t-(this.x+s),i=e-(this.y+s);const r=s*s;if(n*n+i*i<=r||(n=t-(this.x+this.width-s),n*n+i*i<=r)||(i=e-(this.y+this.height-s),n*n+i*i<=r)||(n=t-(this.x+s),n*n+i*i<=r))return!0}return!1}strokeContains(t,e,s,n=.5){const{x:i,y:r,width:o,height:l,radius:c}=this,h=s*(1-n),u=s-h,f=i+c,d=r+c,p=o-c*2,g=l-c*2,y=i+o,m=r+l;return(t>=i-h&&t<=i+u||t>=y-u&&t<=y+h)&&e>=d&&e<=d+g||(e>=r-h&&e<=r+u||e>=m-u&&e<=m+h)&&t>=f&&t<=f+p?!0:t<f&&e<d&&bt(t,e,f,d,c,u,h)||t>y-c&&e<d&&bt(t,e,y-c,d,c,u,h)||t>y-c&&e>m-c&&bt(t,e,y-c,m-c,c,u,h)||t<f&&e>m-c&&bt(t,e,f,m-c,c,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Te={};function Ps(a,t){let e=2166136261;for(let s=0;s<t;s++)e^=a[s].uid,e=Math.imul(e,16777619),e>>>=0;return Te[e]||ws(a,t,e)}let vt=0;function ws(a,t,e){const s={};let n=0;vt||(vt=Ye());for(let r=0;r<vt;r++){const o=r<t?a[r]:D.EMPTY.source;s[n++]=o.source,s[n++]=o.style}const i=new Ve(s);return Te[e]=i,i}const Cs=new Float32Array(1),ks=new Uint32Array(1);class Ms extends Xe{constructor(){const e=new Jt({data:Cs,label:"attribute-batch-buffer",usage:St.VERTEX|St.COPY_DST,shrinkToFit:!1}),s=new Jt({data:ks,label:"index-batch-buffer",usage:St.INDEX|St.COPY_DST,shrinkToFit:!1}),n=24;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:n,offset:0},aUV:{buffer:e,format:"float32x2",stride:n,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:n,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:n,offset:20}},indexBuffer:s})}}class Ts extends Qe{constructor(t){const e=Ze({name:"batch",bits:[Je,ts(t),es]}),s=ss({name:"batch",bits:[ns,is(t),rs]});super({glProgram:e,gpuProgram:s,resources:{batchSamplers:as(t)}})}}let ae=null;const Fe=class Be extends os{constructor(){super(...arguments),this.geometry=new Ms,this.shader=ae||(ae=new Ts(this.maxTextures)),this.name=Be.extension.name,this.vertexSize=6}packAttributes(t,e,s,n,i){const r=i<<16|t.roundPixels&65535,o=t.transform,l=o.a,c=o.b,h=o.c,u=o.d,f=o.tx,d=o.ty,{positions:p,uvs:g}=t,y=t.color,m=t.attributeOffset,x=m+t.attributeSize;for(let P=m;P<x;P++){const _=P*2,w=p[_],S=p[_+1];e[n++]=l*w+h*S+f,e[n++]=u*S+c*w+d,e[n++]=g[_],e[n++]=g[_+1],s[n++]=y,s[n++]=r}}packQuadAttributes(t,e,s,n,i){const r=t.texture,o=t.transform,l=o.a,c=o.b,h=o.c,u=o.d,f=o.tx,d=o.ty,p=t.bounds,g=p.maxX,y=p.minX,m=p.maxY,x=p.minY,P=r.uvs,_=t.color,w=i<<16|t.roundPixels&65535;e[n+0]=l*y+h*x+f,e[n+1]=u*x+c*y+d,e[n+2]=P.x0,e[n+3]=P.y0,s[n+4]=_,s[n+5]=w,e[n+6]=l*g+h*x+f,e[n+7]=u*x+c*g+d,e[n+8]=P.x1,e[n+9]=P.y1,s[n+10]=_,s[n+11]=w,e[n+12]=l*g+h*m+f,e[n+13]=u*m+c*g+d,e[n+14]=P.x2,e[n+15]=P.y2,s[n+16]=_,s[n+17]=w,e[n+18]=l*y+h*m+f,e[n+19]=u*m+c*y+d,e[n+20]=P.x3,e[n+21]=P.y3,s[n+22]=_,s[n+23]=w}};Fe.extension={type:[N.Batcher],name:"default"};let Fs=Fe;function Bs(a,t,e,s,n,i,r,o=null){let l=0;e*=t,n*=i;const c=o.a,h=o.b,u=o.c,f=o.d,d=o.tx,p=o.ty;for(;l<r;){const g=a[e],y=a[e+1];s[n]=c*g+u*y+d,s[n+1]=h*g+f*y+p,n+=i,e+=t,l++}}function vs(a,t,e,s){let n=0;for(t*=e;n<s;)a[t]=0,a[t+1]=0,t+=e,n++}function ve(a,t,e,s,n){const i=t.a,r=t.b,o=t.c,l=t.d,c=t.tx,h=t.ty;e||(e=0),s||(s=2),n||(n=a.length/s-e);let u=e*s;for(let f=0;f<n;f++){const d=a[u],p=a[u+1];a[u]=i*d+o*p+c,a[u+1]=r*d+l*p+h,u+=s}}const zs=new E;class ze{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,s=this.renderable;return s?hs(e,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||zs}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const gt={extension:{type:N.ShapeBuilder,name:"circle"},build(a,t){let e,s,n,i,r,o;if(a.type==="circle"){const _=a;e=_.x,s=_.y,r=o=_.radius,n=i=0}else if(a.type==="ellipse"){const _=a;e=_.x,s=_.y,r=_.halfWidth,o=_.halfHeight,n=i=0}else{const _=a,w=_.width/2,S=_.height/2;e=_.x+w,s=_.y+S,r=o=Math.max(0,Math.min(_.radius,Math.min(w,S))),n=w-r,i=S-o}if(!(r>=0&&o>=0&&n>=0&&i>=0))return t;const l=Math.ceil(2.3*Math.sqrt(r+o)),c=l*8+(n?4:0)+(i?4:0);if(c===0)return t;if(l===0)return t[0]=t[6]=e+n,t[1]=t[3]=s+i,t[2]=t[4]=e-n,t[5]=t[7]=s-i,t;let h=0,u=l*4+(n?2:0)+2,f=u,d=c,p=n+r,g=i,y=e+p,m=e-p,x=s+g;if(t[h++]=y,t[h++]=x,t[--u]=x,t[--u]=m,i){const _=s-g;t[f++]=m,t[f++]=_,t[--d]=_,t[--d]=y}for(let _=1;_<l;_++){const w=Math.PI/2*(_/l),S=n+Math.cos(w)*r,b=i+Math.sin(w)*o,v=e+S,F=e-S,k=s+b,C=s-b;t[h++]=v,t[h++]=k,t[--u]=k,t[--u]=F,t[f++]=F,t[f++]=C,t[--d]=C,t[--d]=v}p=n,g=i+o,y=e+p,m=e-p,x=s+g;const P=s-g;return t[h++]=y,t[h++]=x,t[--d]=P,t[--d]=y,n&&(t[h++]=m,t[h++]=x,t[--d]=P,t[--d]=m),t},triangulate(a,t,e,s,n,i){if(a.length===0)return;let r=0,o=0;for(let h=0;h<a.length;h+=2)r+=a[h],o+=a[h+1];r/=a.length/2,o/=a.length/2;let l=s;t[l*e]=r,t[l*e+1]=o;const c=l++;for(let h=0;h<a.length;h+=2)t[l*e]=a[h],t[l*e+1]=a[h+1],h>0&&(n[i++]=l,n[i++]=c,n[i++]=l-1),l++;n[i++]=c+1,n[i++]=c,n[i++]=l-1}},Ws={...gt,extension:{...gt.extension,name:"ellipse"}},Is={...gt,extension:{...gt.extension,name:"roundedRectangle"}},We=1e-4,oe=1e-4;function Rs(a){const t=a.length;if(t<6)return 1;let e=0;for(let s=0,n=a[t-2],i=a[t-1];s<t;s+=2){const r=a[s],o=a[s+1];e+=(r-n)*(o+i),n=r,i=o}return e<0?-1:1}function he(a,t,e,s,n,i,r,o){const l=a-e*n,c=t-s*n,h=a+e*i,u=t+s*i;let f,d;r?(f=s,d=-e):(f=-s,d=e);const p=l+f,g=c+d,y=h+f,m=u+d;return o.push(p,g),o.push(y,m),2}function J(a,t,e,s,n,i,r,o){const l=e-a,c=s-t;let h=Math.atan2(l,c),u=Math.atan2(n-a,i-t);o&&h<u?h+=Math.PI*2:!o&&h>u&&(u+=Math.PI*2);let f=h;const d=u-h,p=Math.abs(d),g=Math.sqrt(l*l+c*c),y=(15*p*Math.sqrt(g)/Math.PI>>0)+1,m=d/y;if(f+=m,o){r.push(a,t),r.push(e,s);for(let x=1,P=f;x<y;x++,P+=m)r.push(a,t),r.push(a+Math.sin(P)*g,t+Math.cos(P)*g);r.push(a,t),r.push(n,i)}else{r.push(e,s),r.push(a,t);for(let x=1,P=f;x<y;x++,P+=m)r.push(a+Math.sin(P)*g,t+Math.cos(P)*g),r.push(a,t);r.push(n,i),r.push(a,t)}return y*2}function As(a,t,e,s,n,i){const r=We;if(a.length===0)return;const o=t;let l=o.alignment;if(t.alignment!==.5){let W=Rs(a);l=(l-.5)*W+.5}const c=new nt(a[0],a[1]),h=new nt(a[a.length-2],a[a.length-1]),u=s,f=Math.abs(c.x-h.x)<r&&Math.abs(c.y-h.y)<r;if(u){a=a.slice(),f&&(a.pop(),a.pop(),h.set(a[a.length-2],a[a.length-1]));const W=(c.x+h.x)*.5,K=(h.y+c.y)*.5;a.unshift(W,K),a.push(W,K)}const d=n,p=a.length/2;let g=a.length;const y=d.length/2,m=o.width/2,x=m*m,P=o.miterLimit*o.miterLimit;let _=a[0],w=a[1],S=a[2],b=a[3],v=0,F=0,k=-(w-b),C=_-S,z=0,I=0,H=Math.sqrt(k*k+C*C);k/=H,C/=H,k*=m,C*=m;const rt=l,T=(1-rt)*2,B=rt*2;u||(o.cap==="round"?g+=J(_-k*(T-B)*.5,w-C*(T-B)*.5,_-k*T,w-C*T,_+k*B,w+C*B,d,!0)+2:o.cap==="square"&&(g+=he(_,w,k,C,T,B,!0,d))),d.push(_-k*T,w-C*T),d.push(_+k*B,w+C*B);for(let W=1;W<p-1;++W){_=a[(W-1)*2],w=a[(W-1)*2+1],S=a[W*2],b=a[W*2+1],v=a[(W+1)*2],F=a[(W+1)*2+1],k=-(w-b),C=_-S,H=Math.sqrt(k*k+C*C),k/=H,C/=H,k*=m,C*=m,z=-(b-F),I=S-v,H=Math.sqrt(z*z+I*I),z/=H,I/=H,z*=m,I*=m;const K=S-_,at=w-b,ot=S-v,ht=F-b,Vt=K*ot+at*ht,xt=at*ot-ht*K,lt=xt<0;if(Math.abs(xt)<.001*Math.abs(Vt)){d.push(S-k*T,b-C*T),d.push(S+k*B,b+C*B),Vt>=0&&(o.join==="round"?g+=J(S,b,S-k*T,b-C*T,S-z*T,b-I*T,d,!1)+4:g+=2,d.push(S-z*B,b-I*B),d.push(S+z*T,b+I*T));continue}const Xt=(-k+_)*(-C+b)-(-k+S)*(-C+w),Qt=(-z+v)*(-I+b)-(-z+S)*(-I+F),mt=(K*Qt-ot*Xt)/xt,_t=(ht*Xt-at*Qt)/xt,Ft=(mt-S)*(mt-S)+(_t-b)*(_t-b),Y=S+(mt-S)*T,V=b+(_t-b)*T,X=S-(mt-S)*B,Q=b-(_t-b)*B,Ne=Math.min(K*K+at*at,ot*ot+ht*ht),Zt=lt?T:B,Ue=Ne+Zt*Zt*x;Ft<=Ue?o.join==="bevel"||Ft/x>P?(lt?(d.push(Y,V),d.push(S+k*B,b+C*B),d.push(Y,V),d.push(S+z*B,b+I*B)):(d.push(S-k*T,b-C*T),d.push(X,Q),d.push(S-z*T,b-I*T),d.push(X,Q)),g+=2):o.join==="round"?lt?(d.push(Y,V),d.push(S+k*B,b+C*B),g+=J(S,b,S+k*B,b+C*B,S+z*B,b+I*B,d,!0)+4,d.push(Y,V),d.push(S+z*B,b+I*B)):(d.push(S-k*T,b-C*T),d.push(X,Q),g+=J(S,b,S-k*T,b-C*T,S-z*T,b-I*T,d,!1)+4,d.push(S-z*T,b-I*T),d.push(X,Q)):(d.push(Y,V),d.push(X,Q)):(d.push(S-k*T,b-C*T),d.push(S+k*B,b+C*B),o.join==="round"?lt?g+=J(S,b,S+k*B,b+C*B,S+z*B,b+I*B,d,!0)+2:g+=J(S,b,S-k*T,b-C*T,S-z*T,b-I*T,d,!1)+2:o.join==="miter"&&Ft/x<=P&&(lt?(d.push(X,Q),d.push(X,Q)):(d.push(Y,V),d.push(Y,V)),g+=2),d.push(S-z*T,b-I*T),d.push(S+z*B,b+I*B),g+=2)}_=a[(p-2)*2],w=a[(p-2)*2+1],S=a[(p-1)*2],b=a[(p-1)*2+1],k=-(w-b),C=_-S,H=Math.sqrt(k*k+C*C),k/=H,C/=H,k*=m,C*=m,d.push(S-k*T,b-C*T),d.push(S+k*B,b+C*B),u||(o.cap==="round"?g+=J(S-k*(T-B)*.5,b-C*(T-B)*.5,S-k*T,b-C*T,S+k*B,b+C*B,d,!1)+2:o.cap==="square"&&(g+=he(S,b,k,C,T,B,!1,d)));const $e=oe*oe;for(let W=y;W<g+y-2;++W)_=d[W*2],w=d[W*2+1],S=d[(W+1)*2],b=d[(W+1)*2+1],v=d[(W+2)*2],F=d[(W+2)*2+1],!(Math.abs(_*(b-F)+S*(F-w)+v*(w-b))<$e)&&i.push(W,W+1,W+2)}function Ls(a,t,e,s){const n=We;if(a.length===0)return;const i=a[0],r=a[1],o=a[a.length-2],l=a[a.length-1],c=t||Math.abs(i-o)<n&&Math.abs(r-l)<n,h=e,u=a.length/2,f=h.length/2;for(let d=0;d<u;d++)h.push(a[d*2]),h.push(a[d*2+1]);for(let d=0;d<u-1;d++)s.push(f+d,f+d+1);c&&s.push(f+u-1,f)}function Ie(a,t,e,s,n,i,r){const o=ls(a,t,2);if(!o)return;for(let c=0;c<o.length;c+=3)i[r++]=o[c]+n,i[r++]=o[c+1]+n,i[r++]=o[c+2]+n;let l=n*s;for(let c=0;c<a.length;c+=2)e[l]=a[c],e[l+1]=a[c+1],l+=s}const Gs=[],Hs={extension:{type:N.ShapeBuilder,name:"polygon"},build(a,t){for(let e=0;e<a.points.length;e++)t[e]=a.points[e];return t},triangulate(a,t,e,s,n,i){Ie(a,Gs,t,e,s,n,i)}},Ds={extension:{type:N.ShapeBuilder,name:"rectangle"},build(a,t){const e=a,s=e.x,n=e.y,i=e.width,r=e.height;return i>=0&&r>=0&&(t[0]=s,t[1]=n,t[2]=s+i,t[3]=n,t[4]=s+i,t[5]=n+r,t[6]=s,t[7]=n+r),t},triangulate(a,t,e,s,n,i){let r=0;s*=e,t[s+r]=a[0],t[s+r+1]=a[1],r+=e,t[s+r]=a[2],t[s+r+1]=a[3],r+=e,t[s+r]=a[6],t[s+r+1]=a[7],r+=e,t[s+r]=a[4],t[s+r+1]=a[5],r+=e;const o=s/e;n[i++]=o,n[i++]=o+1,n[i++]=o+2,n[i++]=o+1,n[i++]=o+3,n[i++]=o+2}},Es={extension:{type:N.ShapeBuilder,name:"triangle"},build(a,t){return t[0]=a.x,t[1]=a.y,t[2]=a.x2,t[3]=a.y2,t[4]=a.x3,t[5]=a.y3,t},triangulate(a,t,e,s,n,i){let r=0;s*=e,t[s+r]=a[0],t[s+r+1]=a[1],r+=e,t[s+r]=a[2],t[s+r+1]=a[3],r+=e,t[s+r]=a[4],t[s+r+1]=a[5];const o=s/e;n[i++]=o,n[i++]=o+1,n[i++]=o+2}},qs=new E,js=new U;function $s(a,t,e,s){const n=t.matrix?a.copyFrom(t.matrix).invert():a.identity();if(t.textureSpace==="local"){const i=e.getBounds(js);n.translate(-i.x,-i.y),n.scale(1/i.width,1/i.height)}else{n.translate(t.texture.frame.x,t.texture.frame.y),n.scale(1/t.texture.source.width,1/t.texture.source.height);const i=t.texture.source.style;i.addressMode==="clamp-to-edge"&&(i.addressMode="repeat",i.update())}return s&&n.append(qs.copyFrom(s).invert()),n}const Tt={};ke.handleByMap(N.ShapeBuilder,Tt);ke.add(Ds,Hs,Es,gt,Ws,Is);const Ns=new U,Us=new E;function Ks(a,t){const{geometryData:e,batches:s}=t;s.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let n=0;n<a.instructions.length;n++){const i=a.instructions[n];if(i.action==="texture")Os(i.data,s,e);else if(i.action==="fill"||i.action==="stroke"){const r=i.action==="stroke",o=i.data.path.shapePath,l=i.data.style,c=i.data.hole;r&&c&&le(c.shapePath,l,!0,s,e),c&&(o.shapePrimitives[o.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),le(o,l,r,s,e)}}}function Os(a,t,e){const{vertices:s,uvs:n,indices:i}=e,r=i.length,o=s.length/2,l=[],c=Tt.rectangle,h=Ns,u=a.image;h.x=a.dx,h.y=a.dy,h.width=a.dw,h.height=a.dh;const f=a.transform;c.build(h,l),f&&ve(l,f),c.triangulate(l,s,2,o,i,r);const d=u.uvs;n.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const p=dt.get(ze);p.indexOffset=r,p.indexSize=i.length-r,p.attributeOffset=o,p.attributeSize=s.length/2-o,p.baseColor=a.style,p.alpha=a.alpha,p.texture=u,p.geometryData=e,t.push(p)}function le(a,t,e,s,n){const{vertices:i,uvs:r,indices:o}=n;a.shapePrimitives.forEach(({shape:l,transform:c,holes:h})=>{const u=o.length,f=i.length/2,d=[],p=Tt[l.type];let g="triangle-list";if(p.build(l,d),c&&ve(d,c),e){const P=l.closePath??!0,_=t;_.pixelLine?(Ls(d,P,i,o),g="line-list"):As(d,_,!1,P,i,o)}else if(h){const P=[],_=d.slice();Ys(h).forEach(S=>{P.push(_.length/2),_.push(...S)}),Ie(_,P,i,2,f,o,u)}else p.triangulate(d,i,2,f,o,u);const y=r.length/2,m=t.texture;if(m!==D.WHITE){const P=$s(Us,t,l,c);Bs(i,2,f,r,y,2,i.length/2-f,P)}else vs(r,y,2,i.length/2-f);const x=dt.get(ze);x.indexOffset=u,x.indexSize=o.length-u,x.attributeOffset=f,x.attributeSize=i.length/2-f,x.baseColor=t.color,x.alpha=t.alpha,x.texture=m,x.geometryData=n,x.topology=g,s.push(x)})}function Ys(a){const t=[];for(let e=0;e<a.length;e++){const s=a[e].shape,n=[];Tt[s.type].build(s,n),t.push(n)}return t}class Vs{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Xs{constructor(){this.batcher=new Fs,this.instructions=new cs}init(){this.instructions.reset()}get geometry(){return A(us,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const Kt=class Lt{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){Lt.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??Lt.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Ks(t,e);const s=t.batchMode;t.customShader||s==="no-batch"?e.isBatchable=!1:s==="auto"&&(e.isBatchable=e.geometryData.vertices.length<400),t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=dt.get(Xs),{batches:s,geometryData:n}=this._gpuContextHash[t.uid],i=n.vertices.length,r=n.indices.length;for(let h=0;h<s.length;h++)s[h].applyTransform=!1;const o=e.batcher;o.ensureAttributeBuffer(i),o.ensureIndexBuffer(r),o.begin();for(let h=0;h<s.length;h++){const u=s[h];o.add(u)}o.finish(e.instructions);const l=o.geometry;l.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),l.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const c=o.batches;for(let h=0;h<c.length;h++){const u=c[h];u.bindGroup=Ps(u.textures.textures,u.textures.count)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new Vs;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(dt.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(s=>{dt.return(s)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};Kt.extension={type:[N.WebGLSystem,N.WebGPUSystem,N.CanvasSystem],name:"graphicsContext"};Kt.defaultOptions={bezierSmoothness:.5};let Re=Kt;const Qs=8,Pt=11920929e-14,Zs=1;function Ae(a,t,e,s,n,i,r,o,l,c){const u=Math.min(.99,Math.max(0,c??Re.defaultOptions.bezierSmoothness));let f=(Zs-u)/1;return f*=f,Js(t,e,s,n,i,r,o,l,a,f),a}function Js(a,t,e,s,n,i,r,o,l,c){Gt(a,t,e,s,n,i,r,o,l,c,0),l.push(r,o)}function Gt(a,t,e,s,n,i,r,o,l,c,h){if(h>Qs)return;const u=(a+e)/2,f=(t+s)/2,d=(e+n)/2,p=(s+i)/2,g=(n+r)/2,y=(i+o)/2,m=(u+d)/2,x=(f+p)/2,P=(d+g)/2,_=(p+y)/2,w=(m+P)/2,S=(x+_)/2;if(h>0){let b=r-a,v=o-t;const F=Math.abs((e-r)*v-(s-o)*b),k=Math.abs((n-r)*v-(i-o)*b);if(F>Pt&&k>Pt){if((F+k)*(F+k)<=c*(b*b+v*v)){l.push(w,S);return}}else if(F>Pt){if(F*F<=c*(b*b+v*v)){l.push(w,S);return}}else if(k>Pt){if(k*k<=c*(b*b+v*v)){l.push(w,S);return}}else if(b=w-(a+r)/2,v=S-(t+o)/2,b*b+v*v<=c){l.push(w,S);return}}Gt(a,t,u,f,m,x,w,S,l,c,h+1),Gt(w,S,P,_,g,y,r,o,l,c,h+1)}const tn=8,en=11920929e-14,sn=1;function nn(a,t,e,s,n,i,r,o){const c=Math.min(.99,Math.max(0,o??Re.defaultOptions.bezierSmoothness));let h=(sn-c)/1;return h*=h,rn(t,e,s,n,i,r,a,h),a}function rn(a,t,e,s,n,i,r,o){Ht(r,a,t,e,s,n,i,o,0),r.push(n,i)}function Ht(a,t,e,s,n,i,r,o,l){if(l>tn)return;const c=(t+s)/2,h=(e+n)/2,u=(s+i)/2,f=(n+r)/2,d=(c+u)/2,p=(h+f)/2;let g=i-t,y=r-e;const m=Math.abs((s-i)*y-(n-r)*g);if(m>en){if(m*m<=o*(g*g+y*y)){a.push(d,p);return}}else if(g=d-(t+i)/2,y=p-(e+r)/2,g*g+y*y<=o){a.push(d,p);return}Ht(a,t,e,c,h,d,p,o,l+1),Ht(a,d,p,u,f,i,r,o,l+1)}function Le(a,t,e,s,n,i,r,o){let l=Math.abs(n-i);(!r&&n>i||r&&i>n)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),o=Math.max(o,3);let c=l/o,h=n;c*=r?-1:1;for(let u=0;u<o+1;u++){const f=Math.cos(h),d=Math.sin(h),p=t+f*s,g=e+d*s;a.push(p,g),h+=c}}function an(a,t,e,s,n,i){const r=a[a.length-2],l=a[a.length-1]-e,c=r-t,h=n-e,u=s-t,f=Math.abs(l*u-c*h);if(f<1e-8||i===0){(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e);return}const d=l*l+c*c,p=h*h+u*u,g=l*h+c*u,y=i*Math.sqrt(d)/f,m=i*Math.sqrt(p)/f,x=y*g/d,P=m*g/p,_=y*u+m*c,w=y*h+m*l,S=c*(m+x),b=l*(m+x),v=u*(y+P),F=h*(y+P),k=Math.atan2(b-w,S-_),C=Math.atan2(F-w,v-_);Le(a,_+t,w+e,i,k,C,c*h>u*l)}const pt=Math.PI*2,zt={centerX:0,centerY:0,ang1:0,ang2:0},Wt=({x:a,y:t},e,s,n,i,r,o,l)=>{a*=e,t*=s;const c=n*a-i*t,h=i*a+n*t;return l.x=c+r,l.y=h+o,l};function on(a,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),s=t===1.5707963267948966?.551915024494:e,n=Math.cos(a),i=Math.sin(a),r=Math.cos(a+t),o=Math.sin(a+t);return[{x:n-i*s,y:i+n*s},{x:r+o*s,y:o-r*s},{x:r,y:o}]}const ce=(a,t,e,s)=>{const n=a*s-t*e<0?-1:1;let i=a*e+t*s;return i>1&&(i=1),i<-1&&(i=-1),n*Math.acos(i)},hn=(a,t,e,s,n,i,r,o,l,c,h,u,f)=>{const d=Math.pow(n,2),p=Math.pow(i,2),g=Math.pow(h,2),y=Math.pow(u,2);let m=d*p-d*y-p*g;m<0&&(m=0),m/=d*y+p*g,m=Math.sqrt(m)*(r===o?-1:1);const x=m*n/i*u,P=m*-i/n*h,_=c*x-l*P+(a+e)/2,w=l*x+c*P+(t+s)/2,S=(h-x)/n,b=(u-P)/i,v=(-h-x)/n,F=(-u-P)/i,k=ce(1,0,S,b);let C=ce(S,b,v,F);o===0&&C>0&&(C-=pt),o===1&&C<0&&(C+=pt),f.centerX=_,f.centerY=w,f.ang1=k,f.ang2=C};function ln(a,t,e,s,n,i,r,o=0,l=0,c=0){if(i===0||r===0)return;const h=Math.sin(o*pt/360),u=Math.cos(o*pt/360),f=u*(t-s)/2+h*(e-n)/2,d=-h*(t-s)/2+u*(e-n)/2;if(f===0&&d===0)return;i=Math.abs(i),r=Math.abs(r);const p=Math.pow(f,2)/Math.pow(i,2)+Math.pow(d,2)/Math.pow(r,2);p>1&&(i*=Math.sqrt(p),r*=Math.sqrt(p)),hn(t,e,s,n,i,r,l,c,h,u,f,d,zt);let{ang1:g,ang2:y}=zt;const{centerX:m,centerY:x}=zt;let P=Math.abs(y)/(pt/4);Math.abs(1-P)<1e-7&&(P=1);const _=Math.max(Math.ceil(P),1);y/=_;let w=a[a.length-2],S=a[a.length-1];const b={x:0,y:0};for(let v=0;v<_;v++){const F=on(g,y),{x:k,y:C}=Wt(F[0],i,r,u,h,m,x,b),{x:z,y:I}=Wt(F[1],i,r,u,h,m,x,b),{x:H,y:rt}=Wt(F[2],i,r,u,h,m,x,b);Ae(a,w,S,k,C,z,I,H,rt),w=H,S=rt,g+=y}}function cn(a,t,e){const s=(r,o)=>{const l=o.x-r.x,c=o.y-r.y,h=Math.sqrt(l*l+c*c),u=l/h,f=c/h;return{len:h,nx:u,ny:f}},n=(r,o)=>{r===0?a.moveTo(o.x,o.y):a.lineTo(o.x,o.y)};let i=t[t.length-1];for(let r=0;r<t.length;r++){const o=t[r%t.length],l=o.radius??e;if(l<=0){n(r,o),i=o;continue}const c=t[(r+1)%t.length],h=s(o,i),u=s(o,c);if(h.len<1e-4||u.len<1e-4){n(r,o),i=o;continue}let f=Math.asin(h.nx*u.ny-h.ny*u.nx),d=1,p=!1;h.nx*u.nx-h.ny*-u.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,p=!0):f>0&&(d=-1,p=!0);const g=f/2;let y,m=Math.abs(Math.cos(g)*l/Math.sin(g));m>Math.min(h.len/2,u.len/2)?(m=Math.min(h.len/2,u.len/2),y=Math.abs(m*Math.sin(g)/Math.cos(g))):y=l;const x=o.x+u.nx*m+-u.ny*y*d,P=o.y+u.ny*m+u.nx*y*d,_=Math.atan2(h.ny,h.nx)+Math.PI/2*d,w=Math.atan2(u.ny,u.nx)-Math.PI/2*d;r===0&&a.moveTo(x+Math.cos(_)*y,P+Math.sin(_)*y),a.arc(x,P,y,_,w,p),i=o}}function un(a,t,e,s){const n=(o,l)=>Math.sqrt((o.x-l.x)**2+(o.y-l.y)**2),i=(o,l,c)=>({x:o.x+(l.x-o.x)*c,y:o.y+(l.y-o.y)*c}),r=t.length;for(let o=0;o<r;o++){const l=t[(o+1)%r],c=l.radius??e;if(c<=0){o===0?a.moveTo(l.x,l.y):a.lineTo(l.x,l.y);continue}const h=t[o],u=t[(o+2)%r],f=n(h,l);let d;if(f<1e-4)d=l;else{const y=Math.min(f/2,c);d=i(l,h,y/f)}const p=n(u,l);let g;if(p<1e-4)g=l;else{const y=Math.min(p/2,c);g=i(l,u,y/p)}o===0?a.moveTo(d.x,d.y):a.lineTo(d.x,d.y),a.quadraticCurveTo(l.x,l.y,g.x,g.y,s)}}const dn=new U;class fn{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Me,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],i=s[s.length-1];return(n!==t||i!==e)&&s.push(t,e),this}arc(t,e,s,n,i,r){this._ensurePoly(!1);const o=this._currentPoly.points;return Le(o,t,e,s,n,i,r),this}arcTo(t,e,s,n,i){this._ensurePoly();const r=this._currentPoly.points;return an(r,t,e,s,n,i),this}arcToSvg(t,e,s,n,i,r,o){const l=this._currentPoly.points;return ln(l,this._currentPoly.lastX,this._currentPoly.lastY,r,o,t,e,s,n,i),this}bezierCurveTo(t,e,s,n,i,r,o){this._ensurePoly();const l=this._currentPoly;return Ae(this._currentPoly.points,l.lastX,l.lastY,t,e,s,n,i,r,o),this}quadraticCurveTo(t,e,s,n,i){this._ensurePoly();const r=this._currentPoly;return nn(this._currentPoly.points,r.lastX,r.lastY,t,e,s,n,i),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const s=this.shapePrimitives,n=s.length;for(let i=0;i<t.instructions.length;i++){const r=t.instructions[i];this[r.action](...r.data)}if(t.checkForHoles&&s.length-n>1){let i=null;for(let r=n;r<s.length;r++){const o=s[r];if(o.shape.type==="polygon"){const l=o.shape,c=i==null?void 0:i.shape;c&&c.containsPolygon(l)?(i.holes||(i.holes=[]),i.holes.push(o),s.copyWithin(r,r+1),s.length--,r--):i=o}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,s,n,i){return this.drawShape(new U(t,e,s,n),i),this}circle(t,e,s,n){return this.drawShape(new $t(t,e,s),n),this}poly(t,e,s){const n=new ft(t);return n.closePath=e,this.drawShape(n,s),this}regularPoly(t,e,s,n,i=0,r){n=Math.max(n|0,3);const o=-1*Math.PI/2+i,l=Math.PI*2/n,c=[];for(let h=0;h<n;h++){const u=o-h*l;c.push(t+s*Math.cos(u),e+s*Math.sin(u))}return this.poly(c,!0,r),this}roundPoly(t,e,s,n,i,r=0,o){if(n=Math.max(n|0,3),i<=0)return this.regularPoly(t,e,s,n,r);const l=s*Math.sin(Math.PI/n)-.001;i=Math.min(i,l);const c=-1*Math.PI/2+r,h=Math.PI*2/n,u=(n-2)*Math.PI/n/2;for(let f=0;f<n;f++){const d=f*h+c,p=t+s*Math.cos(d),g=e+s*Math.sin(d),y=d+Math.PI+u,m=d-Math.PI-u,x=p+i*Math.cos(y),P=g+i*Math.sin(y),_=p+i*Math.cos(m),w=g+i*Math.sin(m);f===0?this.moveTo(x,P):this.lineTo(x,P),this.quadraticCurveTo(p,g,_,w,o)}return this.closePath()}roundShape(t,e,s=!1,n){return t.length<3?this:(s?un(this,t,e,n):cn(this,t,e),this.closePath())}filletRect(t,e,s,n,i){if(i===0)return this.rect(t,e,s,n);const r=Math.min(s,n)/2,o=Math.min(r,Math.max(-r,i)),l=t+s,c=e+n,h=o<0?-o:0,u=Math.abs(o);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(l-u,e).arcTo(l-h,e+h,l,e+u,u).lineTo(l,c-u).arcTo(l-h,c-h,t+s-u,c,u).lineTo(t+u,c).arcTo(t+h,c-h,t,c-u,u).closePath()}chamferRect(t,e,s,n,i,r){if(i<=0)return this.rect(t,e,s,n);const o=Math.min(i,Math.min(s,n)/2),l=t+s,c=e+n,h=[t+o,e,l-o,e,l,e+o,l,c-o,l-o,c,t+o,c,t,c-o,t,e+o];for(let u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.poly(h,!0,r)}ellipse(t,e,s,n,i){return this.drawShape(new Nt(t,e,s,n),i),this}roundRect(t,e,s,n,i,r){return this.drawShape(new Ut(t,e,s,n,i),r),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let s=this._currentPoly;return s&&this.endPoly(),s=new ft,s.points.push(t,e),this._currentPoly=s,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new ft,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let s=e.shape.x,n=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const i=e.transform,r=s;s=i.a*s+i.c*n+i.tx,n=i.b*r+i.d*n+i.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];this[s.action](...s.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let s=0;s<e.length;s++){const n=e[s],i=n.shape.getBounds(dn);n.transform?t.addRect(i,n.transform):t.addRect(i)}return t}}class it{constructor(t,e=!1){this.instructions=[],this.uid=kt("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?ms(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new fn(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,s,n,i){const r=this.instructions[this.instructions.length-1],o=this.getLastPoint(nt.shared);let l=0,c=0;if(!r||r.action!=="bezierCurveTo")l=o.x,c=o.y;else{l=r.data[2],c=r.data[3];const h=o.x,u=o.y;l=h+(h-l),c=u+(u-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,t,e,s,n,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,s){const n=this.instructions[this.instructions.length-1],i=this.getLastPoint(nt.shared);let r=0,o=0;if(!n||n.action!=="quadraticCurveTo")r=i.x,o=i.y;else{r=n.data[0],o=n.data[1];const l=i.x,c=i.y;r=l+(l-r),o=c+(c-o)}return this.instructions.push({action:"quadraticCurveTo",data:[r,o,t,e,s]}),this._dirty=!0,this}rect(t,e,s,n,i){return this.instructions.push({action:"rect",data:[t,e,s,n,i]}),this._dirty=!0,this}circle(t,e,s,n){return this.instructions.push({action:"circle",data:[t,e,s,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,s,n,i,r,o){i||(i=n/2);const l=-1*Math.PI/2+r,c=s*2,h=Math.PI*2/c,u=[];for(let f=0;f<c;f++){const d=f%2?i:n,p=f*h+l;u.push(t+d*Math.cos(p),e+d*Math.sin(p))}return this.poly(u,!0,o),this}clone(t=!1){const e=new it;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];e.instructions.push({action:n.action,data:n.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,s=t.b,n=t.c,i=t.d,r=t.tx,o=t.ty;let l=0,c=0,h=0,u=0,f=0,d=0,p=0,g=0;for(let y=0;y<this.instructions.length;y++){const m=this.instructions[y],x=m.data;switch(m.action){case"moveTo":case"lineTo":l=x[0],c=x[1],x[0]=e*l+n*c+r,x[1]=s*l+i*c+o;break;case"bezierCurveTo":h=x[0],u=x[1],f=x[2],d=x[3],l=x[4],c=x[5],x[0]=e*h+n*u+r,x[1]=s*h+i*u+o,x[2]=e*f+n*d+r,x[3]=s*f+i*d+o,x[4]=e*l+n*c+r,x[5]=s*l+i*c+o;break;case"quadraticCurveTo":h=x[0],u=x[1],l=x[2],c=x[3],x[0]=e*h+n*u+r,x[1]=s*h+i*u+o,x[2]=e*l+n*c+r,x[3]=s*l+i*c+o;break;case"arcToSvg":l=x[5],c=x[6],p=x[0],g=x[1],x[0]=e*p+n*g,x[1]=s*p+i*g,x[5]=e*l+n*c+r,x[6]=s*l+i*c+o;break;case"circle":x[4]=ct(x[3],t);break;case"rect":x[4]=ct(x[4],t);break;case"ellipse":x[8]=ct(x[8],t);break;case"roundRect":x[5]=ct(x[5],t);break;case"addPath":x[0].transform(t);break;case"poly":x[2]=ct(x[2],t);break;default:et("unknown transform action",m.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,s=this.instructions[e];if(!s)return t.x=0,t.y=0,t;for(;s.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;s=this.instructions[e]}switch(s.action){case"moveTo":case"lineTo":t.x=s.data[0],t.y=s.data[1];break;case"quadraticCurveTo":t.x=s.data[2],t.y=s.data[3];break;case"bezierCurveTo":t.x=s.data[4],t.y=s.data[5];break;case"arc":case"arcToSvg":t.x=s.data[5],t.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(t);break}return t}}function ct(a,t){return a?a.prepend(t):t.clone()}function R(a,t,e){const s=a.getAttribute(t);return s?Number(s):e}function pn(a,t){const e=a.querySelectorAll("defs");for(let s=0;s<e.length;s++){const n=e[s];for(let i=0;i<n.children.length;i++){const r=n.children[i];switch(r.nodeName.toLowerCase()){case"lineargradient":t.defs[r.id]=gn(r);break;case"radialgradient":t.defs[r.id]=yn();break}}}}function gn(a){const t=R(a,"x1",0),e=R(a,"y1",0),s=R(a,"x2",1),n=R(a,"y2",0),i=a.getAttribute("gradientUnits")||"objectBoundingBox",r=new O(t,e,s,n,i==="objectBoundingBox"?"local":"global");for(let o=0;o<a.children.length;o++){const l=a.children[o],c=R(l,"offset",0),h=G.shared.setValue(l.getAttribute("stop-color")).toNumber();r.addColorStop(c,h)}return r}function yn(a){return et("[SVG Parser] Radial gradients are not yet supported"),new O(0,0,1,0)}function ue(a){const t=a.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const de={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Ge(a,t){const e=a.getAttribute("style"),s={},n={},i={strokeStyle:s,fillStyle:n,useFill:!1,useStroke:!1};for(const r in de){const o=a.getAttribute(r);o&&fe(t,i,r,o.trim())}if(e){const r=e.split(";");for(let o=0;o<r.length;o++){const l=r[o].trim(),[c,h]=l.split(":");de[c]&&fe(t,i,c,h.trim())}}return{strokeStyle:i.useStroke?s:null,fillStyle:i.useFill?n:null,useFill:i.useFill,useStroke:i.useStroke}}function fe(a,t,e,s){switch(e){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const n=ue(s);t.strokeStyle.fill=a.defs[n]}else t.strokeStyle.color=G.shared.setValue(s).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const n=ue(s);t.fillStyle.fill=a.defs[n]}else t.fillStyle.color=G.shared.setValue(s).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(s);break;case"stroke-opacity":t.strokeStyle.alpha=Number(s);break;case"opacity":t.fillStyle.alpha=Number(s),t.strokeStyle.alpha=Number(s);break}}function xn(a,t){if(typeof a=="string"){const r=document.createElement("div");r.innerHTML=a.trim(),a=r.querySelector("svg")}const e={context:t,defs:{},path:new it};pn(a,e);const s=a.children,{fillStyle:n,strokeStyle:i}=Ge(a,e);for(let r=0;r<s.length;r++){const o=s[r];o.nodeName.toLowerCase()!=="defs"&&He(o,e,n,i)}return t}function He(a,t,e,s){const n=a.children,{fillStyle:i,strokeStyle:r}=Ge(a,t);i&&e?e={...e,...i}:i&&(e=i),r&&s?s={...s,...r}:r&&(s=r);const o=!e&&!s;o&&(e={color:0});let l,c,h,u,f,d,p,g,y,m,x,P,_,w,S,b,v;switch(a.nodeName.toLowerCase()){case"path":w=a.getAttribute("d"),a.getAttribute("fill-rule")==="evenodd"&&et("SVG Evenodd fill rule not supported, your svg may render incorrectly"),S=new it(w,!0),t.context.path(S),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"circle":p=R(a,"cx",0),g=R(a,"cy",0),y=R(a,"r",0),t.context.ellipse(p,g,y,y),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"rect":l=R(a,"x",0),c=R(a,"y",0),b=R(a,"width",0),v=R(a,"height",0),m=R(a,"rx",0),x=R(a,"ry",0),m||x?t.context.roundRect(l,c,b,v,m||x):t.context.rect(l,c,b,v),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"ellipse":p=R(a,"cx",0),g=R(a,"cy",0),m=R(a,"rx",0),x=R(a,"ry",0),t.context.beginPath(),t.context.ellipse(p,g,m,x),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"line":h=R(a,"x1",0),u=R(a,"y1",0),f=R(a,"x2",0),d=R(a,"y2",0),t.context.beginPath(),t.context.moveTo(h,u),t.context.lineTo(f,d),s&&t.context.stroke(s);break;case"polygon":_=a.getAttribute("points"),P=_.match(/\d+/g).map(F=>parseInt(F,10)),t.context.poly(P,!0),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"polyline":_=a.getAttribute("points"),P=_.match(/\d+/g).map(F=>parseInt(F,10)),t.context.poly(P,!1),s&&t.context.stroke(s);break;case"g":case"svg":break;default:{et(`[SVG parser] <${a.nodeName}> elements unsupported`);break}}o&&(e=null);for(let F=0;F<n.length;F++)He(n[F],t,e,s)}function mn(a){return G.isColorLike(a)}function pe(a){return a instanceof Mt}function ge(a){return a instanceof O}function _n(a){return a instanceof D}function Sn(a,t,e){const s=G.shared.setValue(t??0);return a.color=s.toNumber(),a.alpha=s.alpha===1?e.alpha:s.alpha,a.texture=D.WHITE,{...e,...a}}function bn(a,t,e){return a.texture=t,{...e,...a}}function ye(a,t,e){return a.fill=t,a.color=16777215,a.texture=t.texture,a.matrix=t.transform,{...e,...a}}function xe(a,t,e){return t.buildGradient(),a.fill=t,a.color=16777215,a.texture=t.texture,a.matrix=t.transform,a.textureSpace=t.textureSpace,{...e,...a}}function Pn(a,t){const e={...t,...a},s=G.shared.setValue(e.color);return e.alpha*=s.alpha,e.color=s.toNumber(),e}function tt(a,t){if(a==null)return null;const e={},s=a;return mn(a)?Sn(e,a,t):_n(a)?bn(e,a,t):pe(a)?ye(e,a,t):ge(a)?xe(e,a,t):s.fill&&pe(s.fill)?ye(s,s.fill,t):s.fill&&ge(s.fill)?xe(s,s.fill,t):Pn(s,t)}function Ct(a,t){const{width:e,alignment:s,miterLimit:n,cap:i,join:r,pixelLine:o,...l}=t,c=tt(a,l);return c?{width:e,alignment:s,miterLimit:n,cap:i,join:r,pixelLine:o,...c}:null}const wn=new nt,me=new E,Ot=class $ extends qt{constructor(){super(...arguments),this.uid=kt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new it,this._transform=new E,this._fillStyle={...$.defaultFillStyle},this._strokeStyle={...$.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Me,this._boundsDirty=!0}clone(){const t=new $;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=tt(t,$.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=Ct(t,$.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=tt(t,$.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=tt(t,$.defaultStrokeStyle),this}texture(t,e,s,n,i,r){return this.instructions.push({action:"texture",data:{image:t,dx:s||0,dy:n||0,dw:i||t.frame.width,dh:r||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?G.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new it,this}fill(t,e){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(t!=null&&(e!==void 0&&typeof t=="number"&&(A(L,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=tt(t,$.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(nt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s&&s.action==="fill"?e=s.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=Ct(t,$.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],s=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(s);else{e.data.hole=s;break}}return this._initNextPathLocation(),this}arc(t,e,s,n,i,r){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,s,n,i,r),this}arcTo(t,e,s,n,i){this._tick++;const r=this._transform;return this._activePath.arcTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty,r.a*s+r.c*n+r.tx,r.b*s+r.d*n+r.ty,i),this}arcToSvg(t,e,s,n,i,r,o){this._tick++;const l=this._transform;return this._activePath.arcToSvg(t,e,s,n,i,l.a*r+l.c*o+l.tx,l.b*r+l.d*o+l.ty),this}bezierCurveTo(t,e,s,n,i,r,o){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,l.a*s+l.c*n+l.tx,l.b*s+l.d*n+l.ty,l.a*i+l.c*r+l.tx,l.b*i+l.d*r+l.ty,o),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,s,n){return this._tick++,this._activePath.ellipse(t,e,s,n,this._transform.clone()),this}circle(t,e,s){return this._tick++,this._activePath.circle(t,e,s,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty),this}moveTo(t,e){this._tick++;const s=this._transform,n=this._activePath.instructions,i=s.a*t+s.c*e+s.tx,r=s.b*t+s.d*e+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=i,n[0].data[1]=r,this):(this._activePath.moveTo(i,r),this)}quadraticCurveTo(t,e,s,n,i){this._tick++;const r=this._transform;return this._activePath.quadraticCurveTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty,r.a*s+r.c*n+r.tx,r.b*s+r.d*n+r.ty,i),this}rect(t,e,s,n){return this._tick++,this._activePath.rect(t,e,s,n,this._transform.clone()),this}roundRect(t,e,s,n,i){return this._tick++,this._activePath.roundRect(t,e,s,n,i,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,s,n,i=0,r){return this._tick++,this._activePath.regularPoly(t,e,s,n,i,r),this}roundPoly(t,e,s,n,i,r){return this._tick++,this._activePath.roundPoly(t,e,s,n,i,r),this}roundShape(t,e,s,n){return this._tick++,this._activePath.roundShape(t,e,s,n),this}filletRect(t,e,s,n,i){return this._tick++,this._activePath.filletRect(t,e,s,n,i),this}chamferRect(t,e,s,n,i,r){return this._tick++,this._activePath.chamferRect(t,e,s,n,i,r),this}star(t,e,s,n,i=0,r=0){return this._tick++,this._activePath.star(t,e,s,n,i,r,this._transform.clone()),this}svg(t){return this._tick++,xn(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,s,n,i,r){return t instanceof E?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,s,n,i,r),this)}transform(t,e,s,n,i,r){return t instanceof E?(this._transform.append(t),this):(me.set(t,e,s,n,i,r),this._transform.append(me),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const s=this.instructions[e],n=s.action;if(n==="fill"){const i=s.data;t.addBounds(i.path.bounds)}else if(n==="texture"){const i=s.data;t.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if(n==="stroke"){const i=s.data,r=i.style.alignment,o=i.style.width*(1-r),l=i.path.bounds;t.addFrame(l.minX-o,l.minY-o,l.maxX+o,l.maxY+o)}}return t}containsPoint(t){var n;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let s=!1;for(let i=0;i<e.length;i++){const r=e[i],o=r.data,l=o.path;if(!r.action||!l)continue;const c=o.style,h=l.shapePath.shapePrimitives;for(let u=0;u<h.length;u++){const f=h[u].shape;if(!c||!f)continue;const d=h[u].transform,p=d?d.applyInverse(t,wn):t;if(r.action==="fill")s=f.contains(p.x,p.y);else{const y=c;s=f.strokeContains(p.x,p.y,y.width,y.alignment)}const g=o.hole;if(g){const y=(n=g.shapePath)==null?void 0:n.shapePrimitives;if(y)for(let m=0;m<y.length;m++)y[m].shape.contains(p.x,p.y)&&(s=!1)}if(s)return!0}}return s}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(s),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(s)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Ot.defaultFillStyle={color:16777215,alpha:1,texture:D.WHITE,matrix:null,fill:null,textureSpace:"local"};Ot.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:D.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let q=Ot;const _e=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function Cn(a){const t=[];let e=0;for(let s=0;s<_e.length;s++){const n=`_${_e[s]}`;t[e++]=a[n]}return e=De(a._fill,t,e),e=kn(a._stroke,t,e),e=Mn(a.dropShadow,t,e),t.join("-")}function De(a,t,e){var s;return a&&(t[e++]=a.color,t[e++]=a.alpha,t[e++]=(s=a.fill)==null?void 0:s.styleKey),e}function kn(a,t,e){return a&&(e=De(a,t,e),t[e++]=a.width,t[e++]=a.alignment,t[e++]=a.cap,t[e++]=a.join,t[e++]=a.miterLimit),e}function Mn(a,t,e){return a&&(t[e++]=a.alpha,t[e++]=a.angle,t[e++]=a.blur,t[e++]=a.distance,t[e++]=G.shared.setValue(a.color).toNumber()),e}const Yt=class st extends qt{constructor(t={}){super(),Tn(t);const e={...st.defaultTextStyle,...t};for(const s in e){const n=s;this[n]=e[s]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...st.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...st.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...q.defaultFillStyle,...t},()=>{this._fill=tt({...this._originalFill},q.defaultFillStyle)})),this._fill=tt(t===0?"black":t,q.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...q.defaultStrokeStyle,...t},()=>{this._stroke=Ct({...this._originalStroke},q.defaultStrokeStyle)})),this._stroke=Ct(t,q.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=Cn(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=st.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new st({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){var s,n,i,r;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const o=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(s=this._fill)!=null&&s.texture&&this._fill.texture.destroy(o),(n=this._originalFill)!=null&&n.texture&&this._originalFill.texture.destroy(o),(i=this._stroke)!=null&&i.texture&&this._stroke.texture.destroy(o),(r=this._originalStroke)!=null&&r.texture&&this._originalStroke.texture.destroy(o)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(s,n,i)=>(s[n]=i,e==null||e(n,i),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(G.isColorLike(t)||t instanceof O||t instanceof Mt)}};Yt.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Yt.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let yt=Yt;function Tn(a){const t=a;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=yt.defaultDropShadow;a.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){A(L,"strokeThickness is now a part of stroke");const e=t.stroke;let s={};if(G.isColorLike(e))s.color=e;else if(e instanceof O||e instanceof Mt)s.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))s=e;else throw new Error("Invalid stroke value.");a.stroke={...s,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){A(L,"gradient fill is now a fill pattern: `new FillGradient(...)`");let e;a.fontSize==null?a.fontSize=yt.defaultTextStyle.fontSize:typeof a.fontSize=="string"?e=parseInt(a.fontSize,10):e=a.fontSize;const s=new O({start:{x:0,y:0},end:{x:0,y:(e||0)*1.7}}),n=t.fillGradientStops.map(i=>G.shared.setValue(i).toNumber());n.forEach((i,r)=>{const o=r/(n.length-1);s.addColorStop(o,i)}),a.fill={fill:s}}}class Fn{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const s=ut.get().createCanvas();s.width=t,s.height=e;const n=s.getContext("2d");return{canvas:s,context:n}}getOptimalCanvasAndContext(t,e,s=1){t=Math.ceil(t*s-1e-6),e=Math.ceil(e*s-1e-6),t=te(t),e=te(e);const n=(t<<17)+(e<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let i=this._canvasPool[n].pop();return i||(i=this._createCanvasAndContext(t,e)),i}returnCanvasAndContext(t){const e=t.canvas,{width:s,height:n}=e,i=(s<<17)+(n<<1);t.context.clearRect(0,0,s,n),this._canvasPool[i].push(t)}clear(){this._canvasPool={}}}const Se=new Fn,Bn=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Dt(a){const t=typeof a.fontSize=="number"?`${a.fontSize}px`:a.fontSize;let e=a.fontFamily;Array.isArray(a.fontFamily)||(e=a.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let n=e[s].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Bn.includes(n)&&(n=`"${n}"`),e[s]=n}return`${a.fontStyle} ${a.fontVariant} ${a.fontWeight} ${t} ${e.join(",")}`}const It={willReadFrequently:!0},j=class M{static get experimentalLetterSpacingSupported(){let t=M._experimentalLetterSpacingSupported;if(t!==void 0){const e=ut.get().getCanvasRenderingContext2D().prototype;t=M._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,s,n,i,r,o,l,c){this.text=t,this.style=e,this.width=s,this.height=n,this.lines=i,this.lineWidths=r,this.lineHeight=o,this.maxLineWidth=l,this.fontProperties=c}static measureText(t=" ",e,s=M._canvas,n=e.wordWrap){var x;const i=`${t}:${e.styleKey}`;if(M._measurementCache[i])return M._measurementCache[i];const r=Dt(e),o=M.measureFont(r);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const l=M.__context;l.font=r;const h=(n?M._wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),u=new Array(h.length);let f=0;for(let P=0;P<h.length;P++){const _=M._measureText(h[P],e.letterSpacing,l);u[P]=_,f=Math.max(f,_)}const d=((x=e._stroke)==null?void 0:x.width)||0;let p=f+d;e.dropShadow&&(p+=e.dropShadow.distance);const g=e.lineHeight||o.fontSize;let y=Math.max(g,o.fontSize+d)+(h.length-1)*(g+e.leading);return e.dropShadow&&(y+=e.dropShadow.distance),new M(t,e,p,y,h,u,g+e.leading,f,o)}static _measureText(t,e,s){let n=!1;M.experimentalLetterSpacingSupported&&(M.experimentalLetterSpacing?(s.letterSpacing=`${e}px`,s.textLetterSpacing=`${e}px`,n=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));const i=s.measureText(t);let r=i.width;const o=-i.actualBoundingBoxLeft;let c=i.actualBoundingBoxRight-o;if(r>0)if(n)r-=e,c-=e;else{const h=(M.graphemeSegmenter(t).length-1)*e;r+=h,c+=h}return Math.max(r,c)}static _wordWrap(t,e,s=M._canvas){const n=s.getContext("2d",It);let i=0,r="",o="";const l=Object.create(null),{letterSpacing:c,whiteSpace:h}=e,u=M._collapseSpaces(h),f=M._collapseNewlines(h);let d=!u;const p=e.wordWrapWidth+c,g=M._tokenize(t);for(let y=0;y<g.length;y++){let m=g[y];if(M._isNewline(m)){if(!f){o+=M._addLine(r),d=!u,r="",i=0;continue}m=" "}if(u){const P=M.isBreakingSpace(m),_=M.isBreakingSpace(r[r.length-1]);if(P&&_)continue}const x=M._getFromCache(m,c,l,n);if(x>p)if(r!==""&&(o+=M._addLine(r),r="",i=0),M.canBreakWords(m,e.breakWords)){const P=M.wordWrapSplit(m);for(let _=0;_<P.length;_++){let w=P[_],S=w,b=1;for(;P[_+b];){const F=P[_+b];if(!M.canBreakChars(S,F,m,_,e.breakWords))w+=F;else break;S=F,b++}_+=b-1;const v=M._getFromCache(w,c,l,n);v+i>p&&(o+=M._addLine(r),d=!1,r="",i=0),r+=w,i+=v}}else{r.length>0&&(o+=M._addLine(r),r="",i=0);const P=y===g.length-1;o+=M._addLine(m,!P),d=!1,r="",i=0}else x+i>p&&(d=!1,o+=M._addLine(r),r="",i=0),(r.length>0||!M.isBreakingSpace(m)||d)&&(r+=m,i+=x)}return o+=M._addLine(r,!1),o}static _addLine(t,e=!0){return t=M._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,s,n){let i=s[t];return typeof i!="number"&&(i=M._measureText(t,e,n)+e,s[t]=i),i}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const s=t[e];if(!M.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:M._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:M._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let s="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const i=t[n],r=t[n+1];if(M.isBreakingSpace(i,r)||M._isNewline(i)){s!==""&&(e.push(s),s=""),e.push(i);continue}s+=i}return s!==""&&e.push(s),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,n,i){return!0}static wordWrapSplit(t){return M.graphemeSegmenter(t)}static measureFont(t){if(M._fonts[t])return M._fonts[t];const e=M._context;e.font=t;const s=e.measureText(M.METRICS_STRING+M.BASELINE_SYMBOL),n={ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent,fontSize:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent};return M._fonts[t]=n,n}static clearMetrics(t=""){t?delete M._fonts[t]:M._fonts={}}static get _canvas(){if(!M.__canvas){let t;try{const e=new OffscreenCanvas(0,0),s=e.getContext("2d",It);if(s!=null&&s.measureText)return M.__canvas=e,e;t=ut.get().createCanvas()}catch{t=ut.get().createCanvas()}t.width=t.height=10,M.__canvas=t}return M.__canvas}static get _context(){return M.__context||(M.__context=M._canvas.getContext("2d",It)),M.__context}};j.METRICS_STRING="|q";j.BASELINE_SYMBOL="M";j.BASELINE_MULTIPLIER=1.4;j.HEIGHT_MULTIPLIER=2;j.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const a=new Intl.Segmenter;return t=>[...a.segment(t)].map(e=>e.segment)}return a=>[...a]})();j.experimentalLetterSpacing=!1;j._fonts={};j._newlines=[10,13];j._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];j._measurementCache={};let be=j;const Pe=1e5;function we(a,t,e,s=0){if(a.texture===D.WHITE&&!a.fill)return G.shared.setValue(a.color).setAlpha(a.alpha??1).toHexa();if(a.fill){if(a.fill instanceof Mt){const n=a.fill,i=t.createPattern(n.texture.source.resource,"repeat"),r=n.transform.copyTo(E.shared);return r.scale(n.texture.frame.width,n.texture.frame.height),i.setTransform(r),i}else if(a.fill instanceof O){const n=a.fill,i=n.type==="linear",r=n.textureSpace==="local";let o=1,l=1;r&&e&&(o=e.width+s,l=e.height+s);let c,h=!1;if(i){const{start:u,end:f}=n;c=t.createLinearGradient(u.x*o,u.y*l,f.x*o,f.y*l),h=Math.abs(f.x-u.x)<Math.abs((f.y-u.y)*.1)}else{const{center:u,innerRadius:f,outerCenter:d,outerRadius:p}=n;c=t.createRadialGradient(u.x*o,u.y*l,f*o,d.x*o,d.y*l,p*o)}if(h&&r&&e){const u=e.lineHeight/l;for(let f=0;f<e.lines.length;f++){const d=(f*e.lineHeight+s/2)/l;n.colorStops.forEach(p=>{const g=d+p.offset*u;c.addColorStop(Math.floor(g*Pe)/Pe,G.shared.setValue(p.color).toHex())})}}else n.colorStops.forEach(u=>{c.addColorStop(u.offset,G.shared.setValue(u.color).toHex())});return c}}else{const n=t.createPattern(a.texture.source.resource,"repeat"),i=a.matrix.copyTo(E.shared);return i.scale(a.texture.frame.width,a.texture.frame.height),n.setTransform(i),n}return et("FillStyle not recognised",a),"red"}function Ee(a){if(a==="")return[];typeof a=="string"&&(a=[a]);const t=[];for(let e=0,s=a.length;e<s;e++){const n=a[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const i=n[0].charCodeAt(0),r=n[1].charCodeAt(0);if(r<i)throw new Error("[BitmapFont]: Invalid character range.");for(let o=i,l=r;o<=l;o++)t.push(String.fromCharCode(o))}else t.push(...Array.from(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const qe=class je extends fs{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...je.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const s=e.style.clone();e.overrideFill&&(s._fill.color=16777215,s._fill.alpha=1,s._fill.texture=D.WHITE,s._fill.fill=null),this.applyFillAsTint=e.overrideFill;const n=s.fontSize;s.fontSize=this.baseMeasurementFontSize;const i=Dt(s);e.overrideSize?s._stroke&&(s._stroke.width*=this.baseRenderedFontSize/n):s.fontSize=this.baseRenderedFontSize=n,this._style=s,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,this.fontMetrics=be.measureFont(i),this.lineHeight=s.lineHeight||this.fontMetrics.fontSize||s.fontSize}ensureCharacters(t){var y,m;const e=Ee(t).filter(x=>!this._currentChars.includes(x)).filter((x,P,_)=>_.indexOf(x)===P);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let s;this._currentPageIndex===-1?s=this._nextPage():s=this.pages[this._currentPageIndex];let{canvas:n,context:i}=s.canvasAndContext,r=s.texture.source;const o=this._style;let l=this._currentX,c=this._currentY;const h=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*h;let f=0,d=!1;const p=n.width/this.resolution,g=n.height/this.resolution;for(let x=0;x<e.length;x++){const P=e[x],_=be.measureText(P,o,n,!1);_.lineHeight=_.height;const w=_.width*h,S=Math.ceil((o.fontStyle==="italic"?2:1)*w),b=_.height*h,v=S+u*2,F=b+u*2;if(d=!1,P!==`
`&&P!=="\r"&&P!=="	"&&P!==" "&&(d=!0,f=Math.ceil(Math.max(F,f))),l+v>p&&(c+=f,f=F,l=0,c+f>g)){r.update();const C=this._nextPage();n=C.canvasAndContext.canvas,i=C.canvasAndContext.context,r=C.texture.source,c=0}const k=w/h-(((y=o.dropShadow)==null?void 0:y.distance)??0)-(((m=o._stroke)==null?void 0:m.width)??0);if(this.chars[P]={id:P.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:k,kerning:{}},d){this._drawGlyph(i,_,l+u,c+u,h,o);const C=r.width*h,z=r.height*h,I=new U(l/C*r.width,c/z*r.height,v/C*r.width,F/z*r.height);this.chars[P].texture=new D({source:r,frame:I}),l+=Math.ceil(v)}}r.update(),this._currentX=l,this._currentY=c,this._skipKerning&&this._applyKerning(e,i)}get pageTextures(){return A(L,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const s=this._measureCache;for(let n=0;n<t.length;n++){const i=t[n];for(let r=0;r<this._currentChars.length;r++){const o=this._currentChars[r];let l=s[i];l||(l=s[i]=e.measureText(i).width);let c=s[o];c||(c=s[o]=e.measureText(o).width);let h=e.measureText(i+o).width,u=h-(l+c);u&&(this.chars[i].kerning[o]=u),h=e.measureText(i+o).width,u=h-(l+c),u&&(this.chars[o].kerning[i]=u)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Se.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const s=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new D({source:new Rt({resource:e.canvas,resolution:s,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})}),i={canvasAndContext:e,texture:n};return this.pages[this._currentPageIndex]=i,i}_setupContext(t,e,s){e.fontSize=this.baseRenderedFontSize,t.scale(s,s),t.font=Dt(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,i=(n==null?void 0:n.width)??0;if(n&&(t.lineWidth=i,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=we(n,t)),e._fill&&(t.fillStyle=we(e._fill,t)),e.dropShadow){const r=e.dropShadow,o=G.shared.setValue(r.color).toArray(),l=r.blur*s,c=r.distance*s;t.shadowColor=`rgba(${o[0]*255},${o[1]*255},${o[2]*255},${r.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(r.angle)*c,t.shadowOffsetY=Math.sin(r.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,s,n,i,r){const o=e.text,l=e.fontProperties,c=r._stroke,h=((c==null?void 0:c.width)??0)*i,u=s+h/2,f=n-h/2,d=l.descent*i,p=e.lineHeight*i;r.stroke&&h&&t.strokeText(o,u,f+p-d),r._fill&&t.fillText(o,u,f+p-d)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:s}=this.pages[t];Se.returnCanvasAndContext(e),s.destroy(!0)}this.pages=null}};qe.defaultOptions={textureSize:512,style:new yt,mipmap:!0};let Ce=qe;function vn(a,t,e,s){const n={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=e.baseLineOffset;let i=n.lines[0],r=null,o=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},c=p=>{const g=i.width;for(let y=0;y<l.index;y++){const m=p.positions[y];i.chars.push(p.chars[y]),i.charPositions.push(m+g)}i.width+=p.width,o=!1,l.width=0,l.index=0,l.chars.length=0},h=()=>{let p=i.chars.length-1;if(s){let g=i.chars[p];for(;g===" ";)i.width-=e.chars[g].xAdvance,g=i.chars[--p]}n.width=Math.max(n.width,i.width),i={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(i),n.height+=e.lineHeight},u=e.baseMeasurementFontSize/t.fontSize,f=t.letterSpacing*u,d=t.wordWrapWidth*u;for(let p=0;p<a.length+1;p++){let g;const y=p===a.length;y||(g=a[p]);const m=e.chars[g]||e.chars[" "];if(/(?:\s)/.test(g)||g==="\r"||g===`
`||y){if(!o&&t.wordWrap&&i.width+l.width-f>d?(h(),c(l),y||i.charPositions.push(0)):(l.start=i.width,c(l),y||i.charPositions.push(0)),g==="\r"||g===`
`)i.width!==0&&h();else if(!y){const w=m.xAdvance+(m.kerning[r]||0)+f;i.width+=w,i.spaceWidth=w,i.spacesIndex.push(i.charPositions.length),i.chars.push(g)}}else{const _=m.kerning[r]||0,w=m.xAdvance+_+f;l.positions[l.index++]=l.width+_,l.chars.push(g),l.width+=w}r=g}return h(),t.align==="center"?zn(n):t.align==="right"?Wn(n):t.align==="justify"&&In(n),n}function zn(a){for(let t=0;t<a.lines.length;t++){const e=a.lines[t],s=a.width/2-e.width/2;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=s}}function Wn(a){for(let t=0;t<a.lines.length;t++){const e=a.lines[t],s=a.width-e.width;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=s}}function In(a){const t=a.width;for(let e=0;e<a.lines.length;e++){const s=a.lines[e];let n=0,i=s.spacesIndex[n++],r=0;const o=s.spacesIndex.length,c=(t-s.width)/o;for(let h=0;h<s.charPositions.length;h++)h===i&&(i=s.spacesIndex[n++],r+=c),s.charPositions[h]+=r}}let wt=0;class Rn{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(t,e){var r;let s=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke)s+=e._fill.fill.styleKey,n=!1;else if(e._stroke||e.dropShadow){let o=e.styleKey;o=o.substring(0,o.lastIndexOf("-")),s=`${o}-bitmap`,n=!1}if(!Z.has(s)){const o=new Ce({style:e,overrideFill:n,overrideSize:!0,...this.defaultOptions});wt++,wt>50&&et("BitmapText",`You have dynamically created ${wt} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),o.once("destroy",()=>{wt--,Z.remove(s)}),Z.set(s,o)}const i=Z.get(s);return(r=i.ensureCharacters)==null||r.call(i,t),i}getLayout(t,e,s=!0){const n=this.getFont(t,e);return vn([...t],e,n,s)}measureText(t,e,s=!0){return this.getLayout(t,e,s)}install(...t){var c,h,u,f;let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:(c=t[2])==null?void 0:c.chars,resolution:(h=t[2])==null?void 0:h.resolution,padding:(u=t[2])==null?void 0:u.padding,skipKerning:(f=t[2])==null?void 0:f.skipKerning},A(L,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const s=e==null?void 0:e.name;if(!s)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const n=e.style,i=n instanceof yt?n:new yt(n),r=i._fill.fill!==null&&i._fill.fill!==void 0,o=new Ce({style:i,overrideFill:r,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1}),l=Ee(e.chars);return o.ensureCharacters(l.join("")),Z.set(`${s}-bitmap`,o),o.once("destroy",()=>Z.remove(`${s}-bitmap`)),o}uninstall(t){const e=`${t}-bitmap`,s=Z.get(e);s&&s.destroy()}}const Gn=new Rn;class Et extends ds{constructor(t){t instanceof q&&(t={context:t});const{context:e,roundPixels:s,...n}=t||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new q,this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=s??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new Et(this._context.clone()):(this._ownedContext=null,new Et(this._context))}lineStyle(t,e,s){A(L,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),s&&(n.alpha=s),this.context.strokeStyle=n,this}beginFill(t,e){A(L,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return t!==void 0&&(s.color=t),e!==void 0&&(s.alpha=e),this.context.fillStyle=s,this}endFill(){A(L,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==q.defaultStrokeStyle.width||t.color!==q.defaultStrokeStyle.color||t.alpha!==q.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return A(L,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return A(L,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return A(L,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return A(L,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return A(L,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return A(L,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}export{fs as A,Gn as B,Se as C,Fs as D,q as G,yt as T,be as a,Et as b,Cn as c,ze as d,vn as e,Dt as f,Ps as g,we as h,Re as i};
